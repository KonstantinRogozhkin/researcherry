#!/usr/bin/env bash

# –ë—ã—Å—Ç—Ä—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π Welcome Screen
# –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å–µ –∏–∑ dev.md - –±—ã—Å—Ç—Ä–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ –±–∏–ª–¥–∞

set -e

echo "üöÄ –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π Welcome Screen..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É —Å –∫–æ–¥–æ–º VSCode
cd vscode

echo "üì¶ –ó–∞–ø—É—Å–∫ –±—ã—Å—Ç—Ä–æ–π –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ (–±–µ–∑ –ø–æ–ª–Ω–æ–π —Å–±–æ—Ä–∫–∏)..."
# –°–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
npm run gulp compile-build-without-mangling

if [ $? -eq 0 ]; then
    echo "‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!"
    
    echo "üî® –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∫–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã..."
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å–±–æ—Ä–∫—É
    case "$(uname -s)" in
        Darwin*)
            if [[ "$(uname -m)" == "arm64" ]]; then
                echo "üçé –°–±–æ—Ä–∫–∞ –¥–ª—è macOS ARM64..."
                npm run gulp "vscode-darwin-arm64-min-ci"
            else
                echo "üçé –°–±–æ—Ä–∫–∞ –¥–ª—è macOS x64..."
                npm run gulp "vscode-darwin-x64-min-ci"
            fi
            ;;
        Linux*)
            echo "üêß –°–±–æ—Ä–∫–∞ –¥–ª—è Linux..."
            npm run gulp "vscode-linux-x64-min-ci"
            ;;
        *)
            echo "‚ùå –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞: $(uname -s)"
            exit 1
            ;;
    esac
    
    if [ $? -eq 0 ]; then
        echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
        echo ""
        echo "üéâ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:"
        
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É
        cd ..
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Ç—å –∫ —Å–æ–±—Ä–∞–Ω–Ω–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
        case "$(uname -s)" in
            Darwin*)
                if [[ "$(uname -m)" == "arm64" ]]; then
                    APP_PATH="VSCode-darwin-arm64/Researcherry.app"
                else
                    APP_PATH="VSCode-darwin-x64/Researcherry.app"
                fi
                echo "üì± –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: open \"$APP_PATH\""
                ;;
            Linux*)
                APP_PATH="VSCode-linux-x64/bin/researcherry"
                echo "üì± –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: ./$APP_PATH"
                ;;
        esac
        
        echo ""
        echo "üí° –î–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞!"
        
    else
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ!"
        exit 1
    fi
else
    echo "‚ùå –û—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏!"
    echo "üîç –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö"
    exit 1
fi
